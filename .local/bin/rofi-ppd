#!/bin/sh
# power profile selector with rofi
# REQUIRES: power-profiles-daemon, and it's service running

# rofi theme
theme="$HOME/.config/rofi/theme_sounddevs.rasi"

get_options() {
  echo "Balanced"
  echo "Performance"
  echo "Battery"
}

pre_selection() {
    curr_profile=$( powerprofilesctl get )
}

main() {
  # Notify user if power-profiles-daemon is not installed or not configured
    if ( ! command -v "powerprofilesctl" ); then
         err="Power-profiles-daemon not installed or service not running!"
        rofi -e "$err" -theme $HOME/.config/rofi/main_noicons.rasi
        exit
    fi

  # get current profile to pre-select in rofi
  pre_selection
  
  # get choice from rofi
  choice=$( (get_options) | rofi -dmenu -i -fuzzy -select "$curr_profile" -p "Set profile" -theme $theme -mesg "Active profile: $curr_profile")

  # run the selected command
  case $choice in
  'Balanced')
      asroot powerprofilesctl set balanced && \
      notify-send "Profile changed to:" "󰚀 $choice" || notify-send "ERROR!"
      ;;
  'Performance')
      asroot powerprofilesctl set performance && \
      notify-send "Profile changed to:" " $choice" || notify-send "ERROR!"
    ;;
  'Battery')
      asroot powerprofilesctl set power-saver && \
      notify-send "Profile changed to:" " $choice"|| notify-send "ERROR!"
    ;;
  esac

  # done
  set -e
}

main &

exit 0
