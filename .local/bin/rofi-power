#!/bin/sh
# power menu with rofi

# rofi theme
theme="$HOME/.config/rofi/theme_power.rasi"
confirm_theme="$HOME/.config/rofi/theme_confirm.rasi"

# commands
uptime="`uptime -p | sed -e 's/up //g'`"
i3exit="$HOME/.local/bin/i3exit"

# display
poweroff='󰐥'
reboot='󰓦'
lock=''
suspend=''
logout='󰍃'
yes='Confirm'
no='Cancel'

get_options() {
  echo "$poweroff"
  echo "$reboot"
  echo "$suspend"
  echo "$lock"
  echo "$logout"
}

rofi_confirm() {
  echo -e "$yes\n$no" | rofi -dmenu -p "Confirm" -mesg "Are you sure?" -theme $confirm_theme
}

main() {

  # get choice from rofi
  choice=$( (get_options) | rofi -dmenu -p "Goodbye ${USER}" -mesg "Uptime: $uptime" -no-default-config -theme $theme)
  # get choice from dmenu
  #choice=$( (get_options) | dmenu -p "Goodbye ${USER}" )

  # run the selected command
  case $choice in
  "$poweroff")
    rofi-confirm --query 'Power off?' --yes $yes --no $no --theme $confirm_theme && $i3exit poweroff
    ;;
  "$reboot")
    rofi-confirm --query 'Reboot?' --yes $yes --no $no --theme $confirm_theme && $i3exit reboot
    ;;
  'Hibernate')
    $i3exit hibernate
    ;;
  "$lock")
    $i3exit lock
    ;;
  "$suspend")
    $i3exit suspend
    ;;
  "$logout")
    rofi-confirm --query 'Log out?' --yes $yes --no $no --theme $confirm_theme && $i3exit logout
    ;;
  esac

  # done
  set -e
}

main &

exit 0
