#!/bin/env sh
# a system power menu for both X11 and Wayland
# DEPENDS: i3lock/swaylock (logout on i3 and dwm ONLY)

# set screen-locker command
lock() {
    if [ "$XDG_SESSION_TYPE" = "wayland" ]; then
        swaylock -f -c 121314 -i ~/.config/lockscreen.png -s fit
    else
        maim /tmp/lock.png
        convert /tmp/lock.png -fill black -colorize 50% -filter Gaussian -resize 30% -define "filter:sigma=1" -resize "1920x1080" -gravity center -extent "1920x1080" /tmp/lockblur.png
        xset dpms force off
        i3lock --nofork -c 121314 -f -i /tmp/lockblur.png
    fi
}

# systemd distros use systemctl, else use loginctl
[ "$(cat /proc/1/comm)" = "systemd" ] && ctl=systemctl || ctl=loginctl

case "$1" in
    lock)
        #dunstctl set-paused true
        lock &
        ;;
    logout)
        i3-msg exit || pkill dwm
        ;;
    suspend)
        lock &
        sleep 1
        $ctl suspend
        ;;
    hibernate)
        lock &
        sleep 1
        $ctl hibernate
        ;;
    reboot)
        $ctl reboot
        ;;
    poweroff)
        $ctl poweroff
        ;;
    *)
        echo "Usage: {lock|logout|suspend|hibernate|reboot|poweroff}"
        exit 2
esac

exit 0
